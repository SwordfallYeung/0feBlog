<!DOCTYPE html>
<!-- saved from url=(0055)file:///C:/Users/25065/Desktop/leanote/BaiduSMSAPI.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="tool" content="leanote-desktop-app">
<title>BaiduSMSAPI</title>

  <link type="text/css" rel="stylesheet" href="https://qiushangwenyue.github.io/0feBlog/syntaxhighlighter/styles/shCore.css"/>
  <link type="text/css" rel="stylesheet" href="https://qiushangwenyue.github.io/0feBlog/syntaxhighlighter/styles/shThemeDefault.css"/>
  <script type="text/javascript">
    SyntaxHighlighter.config.clipboardSwf = 'https://qiushangwenyue.github.io/0feBlog/syntaxhighlighter/scripts/clipboard.swf';
    SyntaxHighlighter.all();
  </script>
<style>
.tab{font-size:12px; margin-bottom: 10px;}
.tab a{cursor:pointer;cursor:pointer;display:inline-block;margin-right:10px;color:#000}#tab-html{color:#ccc}

.content-container .content-html{visibility: hidden;}
.content-container.html .content-markdown{display:none}
.content-container.html .content-html{display:block; visibility: visible;}
.content-container.html #tab-markdown{color:#ccc}
.content-container.html #tab-html{color:#000}
.content-markdown {overflow: auto;}
textarea {display: none;}


body {
  margin: 0;
}

/*公用文字样式*/
h1{font-size:30px}h2{font-size:24px}h3{font-size:18px}h4{font-size:14px}
.note-container{
    width:750px; 
    margin:auto;
    padding: 10px 20px;
    box-shadow: 1px 1px 10px #fff;
    background-color: #fff;
}
#title {
  margin: 0;
}
table {
    margin-bottom: 16px;
    border-collapse: collapse;
}
table th, table td {
    padding: 6px 13px;
    border: 1px solid #ddd;
}
table th {
    font-weight: bold;
}

table tr {
    background-color: none;
    border-top: 1px solid #ccc;
}
table tr:nth-child(2n) {
    background-color: rgb(247, 247, 249);
}
.mce-item-table, .mce-item-table td, .mce-item-table th, .mce-item-table caption {
  border: 1px solid #ddd;
  border-collapse: collapse;
  padding: 6px 13px;
}
blockquote {
  border-left-width:10px;
  background-color:rgba(128,128,128,0.05);
  border-top-right-radius:5px;
  border-bottom-right-radius:5px;
  padding:15px 0px;
  margin-left: -10px; 
  border-left:5px solid rgba(128,128,128,0.075);
}
blockquote p {
  margin-bottom:1.1em;
  font-size:1em;
  line-height:1.45
}
blockquote ul:last-child,blockquote ol:last-child {
  margin-bottom:0
}
pre {
  padding: 18px;
  background-color: #f7f7f9;
  border: 1px solid #e1e1e8;
  border-radius: 3px;
  display: block;
}


hr {
  margin:2em 0
}
img {
  max-width:100%;
  display: block;
  margin: auto;
}
pre {
  word-break:break-word
}
p,pre,pre.prettyprint,blockquote {
  margin:0 0 1.1em
}
hr {
  margin:2em 0
}
img {
  max-width:100%
}

</style>

</head>

<body>

	<div class="note-container">
		<div class="content-container html" id="content-container">
			
			<!-- html -->
			<div class="content-html" id="leanote-content-html"><p>详情请看<a href="https://cloud.baidu.com/doc/SMS/API.html#.E7.9F.AD.E4.BF.A1.E4.B8.8B.E5.8F.91">百度云-简单消息服务SMS</a></p>

<p>百度云没有C# SDK。只能调用他们的API实现。首先要认证。 <br>
<img src="https://qiushangwenyue.github.io/0feBlog/Csharp/BaiduSMSAPI_files/58661c2dffd1182df4000000.png" alt="" title=""> <br>
<img src="https://qiushangwenyue.github.io/0feBlog/Csharp/BaiduSMSAPI_files/58661c43ffd1182df4000001.png" alt="" title=""> <br>
<img src="https://qiushangwenyue.github.io/0feBlog/Csharp/BaiduSMSAPI_files/58661c50ffd1182df4000002.png" alt="" title=""></p>

<hr>

<p><strong>HTTP请求示例：</strong></p>

<blockquote>
<pre class="brush: xml;">
  POST /bce/v2/message HTTP/1.1 
  Host: sms.bj.baidubce.com 
  x-bce-content-sha256:e3d5591edbab45d28817fcb1463501d9e68ecb9730f440ac975da368ca4adbfc 
  x-bce-date:2014-06-11T08:23:49Z 
  Content-Type: application/json
  Authorization:bce-auth-v1/AKIAIOSFODNN7EXAMPLE/1323937348/600//host;x-bce-date/=hQJj2pxypqJHQgU/BW1EZGUiNIYGhkQDf7tI6UgQ2qw= 
  Content-Length: 151 
  { 
      “invokeId”: “d2iL60UT-7N8-22368”, 
      “phoneNumber”: “13800138000”,
      “templateCode”: “smsTpl:6nHdNumZ4ZtGaKO”, 
      “contentVar”: { 
          “others”: “你好”,
          “code”: “7890” 
      } 
  }
  </pre>
</blockquote>

<hr>

<p><strong>成功响应示例：</strong></p>

<blockquote>
<pre class="brush: xml;">
  HTTP/1.1 200 OK
  Date: Thu, 12 Jun 2014 09:26:46 GMT
  Content-Type: application/json; charset=utf-8
  x-bce-request-id：98f651c-e230-4810f-8092-f77506d848 
  { 
      “code”: “1000”, 
      “message”: “成功”, 
      “requestId”: “98f651c-e230-4810f-8092-f77506d848”
  }
</pre>
</blockquote>

<hr>

<p>C#版本的短信接口API开发：</p>

<blockquote>
<pre class="brush: c-sharp;">
  using System; 
  using System.Collections.Generic; 
  using System.Linq; 
  using System.Web; 
  namespace PictureTest.BaiduSMS 
  { 
      public class SMSInfo 
      { 
          //模板 
          public string TemplateId { get; set; } 
          //接受者 
          public string Receiver { get; set; } 
          //内容 
          public string ContentVar { get; set; }>
      } 
  }
   </pre>
</blockquote>

<hr>

<blockquote>
<pre class="brush: c-sharp;">
  using System; 
  using System.Collections.Generic; 
  using System.Linq; 
  using System.Web; 
  using System.Security.Cryptography; 
  using System.Text; 
  using System.Net; 
  using System.IO.Compression; 
  namespace PictureTest.BaiduSMS
  { 
      public class BaiduSMSTest 
      { 
          private SMSInfo smsinfo; 
          public SMSInfo Smsinfo 
          { 
              get { return smsinfo; }
              set { smsinfo = value; } 
          } 
          public BaiduSMSTest(SMSInfo smsinfo) 
          { 
              this.smsinfo = smsinfo;
          } 
          public string SendSMSWEBAPI() 
          { 
              try 
              { 
               System.IO.Stream  receiveStream  = null; 
              System.IO.StreamReader responseReader = null; 
              string timestamp =  DateTime.UtcNow.ToString(“yyyy-MM-ddTHH:mm:ssZ”); 
             // string timestamp2 As String = Date.UtcNow.ToString(“yyyy-MM-dd”) 
              string SecretAccessKey  = “申请所得”; 
              string AccessKeyId  = “申请所得”; 
           //   ’  Dim authStringPrefix As String = “bce-auth-v1/{accessKeyId}/{timestamp}/{expirationPeriodInSeconds}” 
              string authStringPrefix = string.Format(“bce-auth-v1/{1}/{0}/1800”, timestamp, AccessKeyId);// ‘这里要改 
            //  ’ Dim CanonicalRequest As String = “HTTP Method + “\n” + CanonicalURI + “\n” + CanonicalQueryString + “\n” + CanonicalHeaders” 
              string CanonicalRequest = string.Format(“POST” + “\n” + “/v1/message” + “\n” + “\n” + “host:sms.bj.baidubce.com”); 
              string SigningKey  = GetSigningKeyByHMACSHA256HEX(SecretAccessKey, authStringPrefix); 
              string Signature  = GetSignatureByHMACSHA256HEX(SigningKey, CanonicalRequest); 
              string Content = string.Empty; 
            // Content = “{ \”templateId\”:” + smsinfo.TemplateId + “,\”receiver\”:” + smsinfo.Receiver + “,\”contentVar\”:” + smsinfo.ContentVar + “}”; 
              Content = “{“+”\”“+”templateId”+”\”“+”:” + smsinfo.TemplateId + “,”+”\”“+”receiver”+”\”“+”:” + smsinfo.Receiver + “,”+”\”“+”contentVar”+”\”“+”:” + smsinfo.ContentVar + “}”; 
             string temp = Content.ToString(); 
             byte[] ContentByte = Encoding.UTF8.GetBytes(temp); 
              string GetOrderURL  = new  Uri(“http://sms.bj.baidubce.com/v1/message“).ToString();
              System.Net.HttpWebRequest HttpWReq  =(WebRequest.Create(GetOrderURL) as System.Net.HttpWebRequest); 
              //’ HttpWReq.Timeout = 600 * 1000 ”一分钟查询 
              HttpWReq.ContentLength = ContentByte.Length; 
              HttpWReq.ContentType = “application/json”; 
              HttpWReq.Headers[“x-bce-date”] = timestamp; 
              HttpWReq.Headers[“Authorization”] = string.Format(“bce-auth-v1/{2}/{0}/1800/host/{1}”, timestamp, Signature, AccessKeyId); 
              HttpWReq.Host = “sms.bj.baidubce.com”; 
              HttpWReq.Method = “POST”;
              HttpWReq.KeepAlive = false; 
              System.IO.Stream StreamData   = HttpWReq.GetRequestStream(); 
              StreamData.Write(ContentByte, 0, ContentByte.Length);
              StreamData.Close(); 
              System.Net.HttpWebResponse  HttpWRes  =(System.Net.HttpWebResponse) HttpWReq.GetResponse();
              if (HttpWRes.Headers.Get(“Content-Encoding”) == “gzip” ){ 
                  System.IO.Stream  zipStream = HttpWRes.GetResponseStream(); 
                  receiveStream = new  GZipStream(zipStream, CompressionMode.Decompress); 
              }else 
              { 
                  receiveStream = HttpWRes.GetResponseStream();
              } 
              responseReader = new  System.IO.StreamReader(receiveStream); 
              string responseString  = responseReader.ReadToEnd(); 
              return responseString; 
              } 
              catch (Exception ex) 
              { 
                  throw ex; 
              } 
          } 
            public string  GetSigningKeyByHMACSHA256HEX(String SecretAccessKey  , String authStringPrefix ){ 
             HMACSHA256 Livehmacsha256 = new  HMACSHA256(Encoding.UTF8.GetBytes(SecretAccessKey)); 
            byte[] LiveHash  = Livehmacsha256.ComputeHash(Encoding.UTF8.GetBytes(authStringPrefix)); 
            string SigningKey  = HashEncode(LiveHash); 
            return SigningKey; 
            } 
            public string GetSignatureByHMACSHA256HEX( String SigningKey , String CanonicalRequest) {
            HMACSHA256 Livehmacsha256   = new  HMACSHA256(Encoding.UTF8.GetBytes(SigningKey)); 
            byte[] LiveHash  = Livehmacsha256.ComputeHash(Encoding.UTF8.GetBytes(CanonicalRequest)); 
            string   Signature  = HashEncode(LiveHash); 
            return Signature;} 
         //将字符串全部变成小写。 
          public string  HashEncode(byte[] hash) { 
          return BitConverter.ToString(hash).Replace(“-“, “”).ToLower(); 
         }
          public string GetSHA256hash(string input , string _input_charset ){ 
          byte[] clearBytes  = Encoding.UTF8.GetBytes(input); 
          SHA256 sha256  = new  SHA256Managed(); 
          sha256.ComputeHash(clearBytes); 
          byte[] hashedBytes = sha256.Hash; 
          sha256.Clear();
          string   output = BitConverter.ToString(hashedBytes).Replace(“-“, “”).ToLower(); 
          return output; 
         } 
      } 
  }
  </pre>
</blockquote>

<hr>

<p>测试代码：</p>

<blockquote>
<pre class="brush: c-sharp;">
  protected void btntest_Click(object sender, EventArgs e) {  
            SMSInfo SMSinfo   = new  SMSInfo(); 
            SMSinfo.TemplateId = “\”“+”短信模版”+”\”“; 
            SMSinfo.Receiver = “[“+”\”“+手机号码+”\”“+”]”; 
            SMSinfo.ContentVar = “{\”参数一\”:\”zhangsan \”,\”参数二\”:\”99999 \”,\”参数三\”:\”我是测试内容\”}”; 
            BaiduSMSTest bdsms   = new  BaiduSMSTest(SMSinfo);
           string result  = bdsms.SendSMSWEBAPI(); 
      } 
 </pre>
</blockquote></div>
		</div>
	</div>

<!-- 该js供其它处理 -->
<!-- <script src="https://qiushangwenyue.github.io/0feBlog/jquery-syntax/examples/jquery-1.6.min.js" type="text/javascript"></script> -->
<script src="https://qiushangwenyue.github.io/0feBlog/Csharp/BaiduSMSAPI_files/markdown-to-html.min.js"></script>
<!-- <script src="https://qiushangwenyue.github.io/0feBlog/jquery-syntax/public/jquery.syntax.js" type="text/javascript"></script>
<script src="https://qiushangwenyue.github.io/0feBlog/jquery-syntax/public/jquery.syntax.cache.js" type="text/javascript"></script> -->
<script>
      // $(function() {
      //   jQuery.syntax();
      // });
</script>

</body></html>